{% extends "smart-admin-2/base-crud.html" %} {% load static %} {% load custom_filters %} {% block breadcrumb %} <div id=ribbon > <span class=ribbon-button-alignment > <span id=refresh  class="btn btn-ribbon" data-action=resetWidgets  data-title=refresh  rel=tooltip  data-placement=bottom  data-original-title="<i class='text-warning fa fa-warning'></i> Warning! This will reset all your widget settings." data-html="true"> <i class="fa fa-refresh"></i> </span> </span> <ol class=breadcrumb > {% for i in my_active %} <li>{{i}} {% endfor %} </ol> </div> {% endblock %} {% block content %} <div id=content > <div class=row > <div class="col-xs-12 col-sm-7 col-md-7 col-lg-4"> <h1 class="page-title txt-color-blueDark"> {% for i in my_menu %} {% if i.name in my_active %} <i class="fa-fw fa {{ i.icon }}"></i> {% endif %} {% endfor %} {% for i in my_active %} {% if forloop.last %} {{ i }} {% endif %} {% endfor %} </h1> </div> <div class="col-xs-12 col-sm-5 col-md-5 col-lg-8"> </div> </div> <section id=widget-grid  class=""> <div class=row > <article class="col-xs-12 col-sm-6 col-md-6 col-lg-6"> <div class="jarviswidget jarviswidget-color-yellow" id=wid-id-0  data-widget-colorbutton=false  data-widget-custombutton=false  data-widget-fullscreenbutton=false  data-widget-editbutton=false > <header> <span class=widget-icon > <i class="fa fa-lg fa-user"></i> </span> <h2>User Information {% for i in service %} {{i.name}} {% endfor %} </h2> </header> <div> <div class=jarviswidget-editbox > </div> <div class="widget-body "> <div class=tree > <ul> <li> <span><i class="fa fa-lg fa-user"></i> &nbsp;Name: {{user.email}} <strong>{{user.name}} </strong></span> <ul> {% for i in agency %} <li> <span class="label label-success"> <i class="fa fa-lg fa-plus-circle"></i> &nbsp;Agency: [ {{i.shortuuid}} ] <strong>{{i.name}} </strong></span> <ul> {% for j in service|slice:"forloop.counter0:forloop.counter0+1" %} {% for k in j %} {% if k.agency_id == i.id %} <li> <span><i class="fa fa-clock-o"></i> Service: <strong>{{k.get_kind_display}}</strong>, expired: {{k.expired_date}} </span> {% endif %} {% endfor %} {% endfor %} </ul> {% endfor %} </ul> </ul> </div> </div> </div> </div> <div class="jarviswidget jarviswidget-color-red" id=wid-id-1  data-widget-colorbutton=false  data-widget-custombutton=false  data-widget-fullscreenbutton=false  data-widget-editbutton=false > <header> <span class=widget-icon > <i class="fa fa-bar-chart-o"></i> </span> <h2>Template</h2> </header> <div> <div class=jarviswidget-editbox > </div> <div class="widget-body "> <table class=table  > <tr> <td >Name <td colspan=2 > <select name=template_id  class=select2_template  style="width: 100%; "> </select> <tr> <td >Thumbnail {% if template.file_path %} <td> <img id=template_photo  src="/media/{{template.file_path}}" width="100%"> {% endif %} <td> <a href="javascript:void(0);" id=template_change  onclick="template_change()" class="btn bg-color-teal txt-color-white">Change</a> {% for i in agency %} {% for j in service|slice:"forloop.counter0:forloop.counter0+1" %} {% for k in j %} {% if k.agency_id == i.id %} <input type=hidden  id=service_id  name=service_id  value="{{k.kind}}"> {% endif %} {% endfor %} {% endfor %} {% endfor %} </table> </div> </div> </div> </article> <article class="col-xs-12 col-sm-6 col-md-6 col-lg-6"> <div class="jarviswidget jarviswidget-color-green" id=wid-id-0  data-widget-colorbutton=false  data-widget-custombutton=false  data-widget-fullscreenbutton=false  data-widget-editbutton=false > <header> <span class=widget-icon > <i class="fa fa-bar-chart-o"></i> </span> <h2>Active Settings</h2> </header> <div> <div class=jarviswidget-editbox > </div> <div class="widget-body "> <table class=table  > <tr> <td width="20%">ID <td> {{user.email}} <tr> <td >Name <td> {% if user.name %} {{user.name}} {% else %} Not Set {% endif %} <tr> <td >Group <td> {% for group in user.groups.all %} {{group.name}} {% endfor %} <tr> <td >Site <td> {% for i in agency %} {% for j in service|slice:"forloop.counter0:forloop.counter0+1" %} {% for k in j %} {% if k.agency_id == i.id %} <a href="{% if request.is_secure %}https://{% else %}http://{% endif %}{{k.site}}" title="Go to {% if request.is_secure %}https://{% else %}http://{% endif %}{{k.site}}" class="btn bg-color-teal txt-color-white" target=_blank  > {{k.site}} </a> {% endif %} {% endfor %} {% endfor %} {% endfor %} </table> </div> </div> </div> <div class="jarviswidget jarviswidget-color-yellow" id=wid-id-1  data-widget-colorbutton=false  data-widget-custombutton=false  data-widget-fullscreenbutton=false  data-widget-editbutton=false > <header> <span class=widget-icon > <i class="fa fa-bar-chart-o"></i> </span> <h2>Agency</h2> </header> <div> <div class=jarviswidget-editbox > </div> <div class="widget-body "> <table class=table  > <tr> <td width="20%">Name <td> {% for i in agency %} <a href="javascript:void(0);" title="Change Agency Name" class="btn bg-color-teal txt-color-white" onclick="fiture_not_ready()"> {{i.name}} </a> {% endfor %} <tr> <td >Code <td> {% for i in agency %} <a href="javascript:void(0);" title="Copy Agency Code" class="btn bg-color-teal txt-color-white" onclick="fiture_not_ready()"> {{i.shortuuid}} </a> {% endfor %} <tr> <td >Service <td> {% for i in agency %} {% for j in service|slice:"forloop.counter0:forloop.counter0+1" %} {% for k in j %} {% if k.agency_id == i.id %} {{k.get_kind_display}} {% endif %} {% endfor %} {% endfor %} {% endfor %} <tr> <td >Expired <td> {% for i in agency %} {% for j in service|slice:"forloop.counter0:forloop.counter0+1" %} {% for k in j %} {% if k.agency_id == i.id %} {{k.expired_date}} {% endif %} {% endfor %} {% endfor %} {% endfor %} <tr> <td >User <td> 1 </table> </div> </div> </div> </article> <article class="col-xs-12 col-sm-12 col-md-12 col-lg-12"> <div class="jarviswidget jarviswidget-color-blueDark" id=wid-id-1  data-widget-colorbutton=false  data-widget-editbutton=false  data-widget-custombutton=false  data-widget-fullscreenbutton=false  > <header> <span class=widget-icon > <i class="fa fa-comments"></i> </span> <h2>Hit Count (three month earlier)</h2> </header> <div> <div class=jarviswidget-editbox > <input class=form-control  type=text > </div> <div class=widget-body > <div class=row > <div class=col-lg-12 > <div class="btn-group pull-right"> <button class="btn btn-primary period"> Period </button> <button class="btn btn-primary dropdown-toggle" data-toggle=dropdown > <span class=caret ></span> </button> <ul class=dropdown-menu > <li> <a href="javascript:void(0);" onclick="change_period(4, this.text);">Monthly</a> <li> <a href="javascript:void(0);" onclick="change_period(3, this.text);">Weekly</a> <li> <a href="javascript:void(0);" onclick="change_period(2, this.text);">Daily</a> </ul> </div> </div> </div> <div class=row > <div class=col-lg-12 > <div id=id_hit_count ></div> </div> </div> </div> </div> </div> </article> </div> <div class=row > <div class=col-sm-12 > </div> </div> </section> </div> {% endblock %} {% block extra_body %} <script> {% if template_init %} var init_template_id = {{template_init|safe}}; var template_id = {{template_init.id}}; {% endif %} function fiture_not_ready() { alert('Fiture belum siap!'); }; function template_change() { if (confirm('Ubah ke template ini?')) { var template_id2 = $(".select2_template").val(); $.ajax({ url: "/dashboard/template_change/" + template_id2, success: function(result){ if (result=="True") { template_id = template_id2; $("#template_change").attr("disabled", true); alert('Template telah diubah'); } else alert('Template gagal diubah!'); } }); } } function change_period(period, name) { $('.period').text(name); create_hit_count(period); }; function create_hit_count(period) { Highcharts.getJSON( "/dashboard/hitcount-ajax/" + period, function (data) { Highcharts.chart('id_hit_count', { chart: { type: 'spline', scrollablePlotArea: { minWidth: 1000, scrollPositionX: 1000 }, }, title: { text: 'Website Hit Count' }, subtitle: { text: 'Based on Unique Visitors Per Day' }, xAxis: { categories: data[0], }, yAxis: { title: { text: 'Hit Count' }, }, plotOptions: { line: { dataLabels: { enabled: true }, enableMouseTracking: false } }, series: [{ name: 'Hit Count', data: data[1] }] }); } ); }; $(document).ready(function() { var current_site = $('#current_site'); var curr_site = { 'href': current_site.attr('href'), 'text': current_site.text()}; localStorage.setItem('curr_site', JSON.stringify(curr_site)); change_period(2, 'Daily'); $('.tree > ul').attr('role', 'tree').find('ul').attr('role', 'group'); $('.tree').find('li:has(ul)').addClass('parent_li').attr('role', 'treeitem').find(' > span').attr('title', 'Collapse this branch').on('click', function(e) { var children = $(this).parent('li.parent_li').find(' > ul > li'); if (children.is(':visible')) { children.hide('fast'); $(this).attr('title', 'Expand this branch').find(' > i').removeClass().addClass('fa fa-lg fa-plus-circle'); } else { children.show('fast'); $(this).attr('title', 'Collapse this branch').find(' > i').removeClass().addClass('fa fa-lg fa-minus-circle'); } e.stopPropagation(); }); var service_id = $("#service_id").val(); console.log('service id', service_id); $('.select2_template').select2({ ajax: { url: '/dashboard/template_lookup_ajax/' + service_id, delay: 250, dataType: 'json', data: function (params) { var query = { search: params.term, page: params.page || 1 }; return query; }, processResults: function (data, params) { params.page = params.page || 1; return { results: data.results, pagination: { more: (params.page * 10) < data.count_filtered } }; }, }, theme: 'bootstrap4', }); $('.select2_template').on('select2:open', () => { this.querySelector('.select2-search__field').focus(); }); $('.select2_template').on('select2:select', function (e) { var data = e.params.data; if (template_id==data.id) $("#template_change").attr("disabled", true); else $("#template_change").attr("disabled", false); $.ajax({ url: "/dashboard/template_photo_ajax/" + data.id, success: function(result){ console.log(result[0]['file_path']); $("#template_photo").attr("src", '/media/' + result[0]['file_path']); } }); }); console.log(init_template_id); $(".select2_template").select2("trigger", "select", { data : init_template_id }); }); </script> {% endblock %}