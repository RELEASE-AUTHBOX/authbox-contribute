{% extends "allauth/base.html" %} {% load static %} {% load i18n %} {% load account socialaccount %} {% block header %} <div id=logo-group > <span id=logo > <img src="{% static 'smart-admin-2/img/logo.png' %}" alt=SmartAdmin > </span> </div> {% endblock %} {% block content %} <div id=content class=container > <div class=row > <div class="col-xs-12 col-sm-12 col-md-7 col-lg-8 hidden-xs hidden-sm"> {% include "allauth/snippets/login_info.html" %} <div class=row > </div> </div> <div class="col-xs-12 col-sm-12 col-md-5 col-lg-4"> <div class="well no-padding"> <form method=POST id=init-form class="smart-form client-form"> {% csrf_token %} <header> {% trans "Inisialisasi Data" %} </header> <fieldset> {% comment %} {% if form.errors %} <p style="color: crimson ;"><b>{% trans "Nama Pengguna dan Sandi Masih Salah. Silahkan Coba Kembali." %}</b></p><br> {% endif %} {% endcomment %} <section> <label class=label >Nama Instansi</label> <label class=input > <input id=agent-name name=agent-name type=text list=list > <datalist id=list > {% for i in agency %} <option value="{{i.name}}">{{i.name}} {% endfor %} </datalist> </label> </section> <section> <label class=label >Jenis Instansi</label> <label class=select > <select id=select_service name=select_service > <option value=0 >--pilih salah satu-- {% for i, j in service_opt %} <option value="{{i}}">{{j}} {% endfor %} </select> <i></i> </label> </section> <section> <label class=label >Nama Template</label> <label class=select > <select id=id_select2_template name=select2_template class=select2_template style="width: 100%; "> </select> </label> </section> </fieldset> <footer> <button id=btn-sign-in type=submit class="btn btn-primary"> {% trans "Submit" %} </button> </footer> </form> </div> </div> </div> </div> {% endblock %} {% block extra_body %} <script> $(function() { let main_domain = "{{main_domain}}"; console.log('maindomain', main_domain); console.log('baseurl', window.location.host); console.log('origin', window.location.origin.toString()); let url = window.location.origin.toString(); console.log('url',url); let rep = url.replace(window.location.host, main_domain); console.log('replace', rep); if (main_domain !== window.location.host) window.location.href = rep + "/" + "dashboard"; const queryString = window.location.search; const urlParams = new URLSearchParams(queryString); let site_id = "{{site_id}}"; const session_key = urlParams.get('s'); const user_id = urlParams.get('u'); const social_media = urlParams.get('media'); if (session_key != null) { $(".provider").html( "<br>" + "<a href='/social-media/"+ user_id +"/" + session_key + "/'><h5><strong><i class='fa fa-"+ social_media + "'></i> {% trans 'Go to Dashboard Now' %} <i class='fa fa-arrow-circle-right'></i> </strong></h5></a>" + '<h5 class=text-center > - {% trans "or" %} -</h5>' ); } else { $(".socialaccount_provider").each(function() { tmp = $(this).attr('href'); link = tmp.split("/"); if (link.length>3) $(this).attr('href', main_domain + '/login-social-media/'+ link[3] + '/' + site_id + '/'); }); }; $("#btn-sign-in").click(function() { window.history.pushState(null, null, window.location.pathname); localStorage.removeItem('session_key'); }); {% comment %} {% if request.user.is_authenticated %} console.log('is auth'); {% else %} console.log('is not auth'); $.ajax({ url: "/post-login/force-authenticate/4/", success: function(result) { console.log('force authenticate:',result); } }); {% endif %} {% endcomment %} $('.select2_template').select2({placeholder: "--Pilih salah satu--"}); $('#select_service').on('change', function (e) { var optionSelected = $("option:selected", this); var valueSelected = this.value; console.log('res', optionSelected, valueSelected); $('.select2_template').val('0'); $('.select2_template').trigger('change'); $('.select2_template').select2({ ajax: { url: "/dashboard/service-change-ajax/" + valueSelected, delay: 250, dataType: 'json', data: function (params) { var query = { search: params.term, page: params.page || 1 }; return query; }, processResults: function (data, params) { params.page = params.page || 1; return { results: data.results, pagination: { more: (params.page * 10) < data.count_filtered } }; }, }, placeholder: "--Pilih salah satu--", allowClear: false, }); }); $('form').submit(function () { var name = $.trim($('#agent-name').val()); console.log('name', name); var select_service = $('#select_service').find(":selected").val(); console.log('select_service', select_service); var select_template = $('#id_select2_template').find(":selected").val(); console.log('select_template', select_template); var mfind = false; if (name === '') { alert('Nama Instansi masih kosong.'); mfind = true; } if ((!mfind) && (select_service==0)) { alert('Jenis Instansi belum dipilih.'); mfind = true; } if ((!mfind) && (select_template===undefined)) { alert('Nama template belum dipilih.'); mfind = true; } return (!mfind); }); }); </script> {% endblock %}