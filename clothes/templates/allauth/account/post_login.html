{% extends "allauth/base.html" %} {% load static %} {% load i18n %} {% load account socialaccount %} {% block header %} <div id=logo-group > <span id=logo > <img src="{% static 'smart-admin-2/img/logo.png' %}" alt=SmartAdmin > </span> </div> <span id=extr-page-header-space > <span class="hidden-mobile hiddex-xs">{% trans "Create an Account" %}?</span> <a href=login.html class="btn btn-danger">{% trans "Sign Up" %}</a> </span> {% endblock %} {% block content %} <div id=content class=container > <div class=row > <div class="col-xs-12 col-sm-12 col-md-7 col-lg-8 hidden-xs hidden-sm"> {% include "allauth/snippets/login_info.html" %} <div class=row > </div> </div> <div class="col-xs-12 col-sm-12 col-md-5 col-lg-4"> <div class="well no-padding"> <form method=POST id=login-form class="smart-form client-form"> {% csrf_token %} <header> {% trans "Redirect Login to Dashboard" %} </header> <fieldset> <div id=redirect_to >{% trans "Please Wait" %} ...</div> <br> <br><br> </fieldset> </form> </div> </div> </div> </div> {% endblock %} {% block extra_body %} <script> $(function() { var session_key = localStorage.getItem('session_key'); console.log('post-login', session_key); console.log("username {{request.user.id}}"); let active_domain = "{{active_domain}}"; let main_domain = "{{main_domain}}"; if (session_key != null) { var user_id = "{{request.user.id}}"; $.ajax({ url: "/post-login/redirect/" + user_id + "/" + session_key + "/", success: function(result) { $.ajax({ url: "/force-authenticate-out/", success: function(data) { console.log('logout success!'); setTimeout(function() { window.location.href = result; }, 1500); } }); } }); } else { console.log('origin login procedure'); window.location.href = '/id/dashboard/'; }; }); </script> {% endblock %}